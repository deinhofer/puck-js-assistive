"use strict";(self.webpackChunkasterics_grid=self.webpackChunkasterics_grid||[]).push([[192],{6192:(e,t,n)=>{var i,o;n.r(t),n.d(t,{default:()=>r}),e=n.hmd(e),i="undefined"!=typeof self?self:void 0,o=function(){if("undefined"!=typeof navigator){var e,t,n=[],i="6e400001-b5a3-f393-e0a9-e50e24dcca9e",o="6e400002-b5a3-f393-e0a9-e50e24dcca9e",r="6e400003-b5a3-f393-e0a9-e50e24dcca9e",c=20,a={debug:1,increaseMTU:!0,flowControl:!0,log:function(e,t){e<=this.debug&&console.log("<BLE> "+t)},writeProgress:function(e,t){},connect:f,write:d,eval:function(e,t){const n=d("Bluetooth.println(JSON.stringify("+e+"))\n",!0).then((function(e){try{return JSON.parse(e)}catch(t){return u(1,"Unable to decode "+JSON.stringify(e)+", got "+t.toString()),Promise.reject(e)}}));return t?void n.then(t,(e=>t(null,e))):n},setTime:function(e){var t=new Date,n="setTime("+t.getTime()/1e3+");";d(n+="if (E.setTimeZone) E.setTimeZone("+t.getTimezoneOffset()/-60+");\n",e)},isConnected:function(){return void 0!==t},getConnection:function(){return t},close:function(){t&&t.close()},modal:function(e){var t=document.createElement("div");t.style="position:absolute;top:0px;left:0px;right:0px;bottom:0px;opacity:0.5;z-index:100;background:black;",t.innerHTML='<div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-family: Sans-Serif;font-size:400%;color:white;">Click to Continue...</div>',t.onclick=function(n){e(),n.preventDefault(),document.body.removeChild(t)},document.body.appendChild(t)}};return a}function s(){return navigator.platform.indexOf("Win")>=0&&(navigator.userAgent.indexOf("Chrome/54")>=0||navigator.userAgent.indexOf("Chrome/55")>=0||navigator.userAgent.indexOf("Chrome/56")>=0)?(console.warn("Chrome <56 in Windows has navigator.bluetooth but it's not implemented properly"),confirm("Web Bluetooth on Windows is not yet available.\nPlease click Ok to see other options for using Web Bluetooth")&&(window.location="https://www.espruino.com/Puck.js+Quick+Start"),!1):!!navigator.bluetooth||(console.warn("No Web Bluetooth on this platform"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?confirm("To use Web Bluetooth on iOS you'll need the WebBLE App.\nPlease click Ok to go to the App Store and download it.")&&(window.location="https://itunes.apple.com/us/app/webble/id1193531073"):confirm("This Web Browser doesn't support Web Bluetooth.\nPlease click Ok to see instructions for enabling it.")&&(window.location="https://www.espruino.com/Quick+Start+BLE#with-web-bluetooth"),!1)}function u(e,t){a.log&&a.log(e,t)}function l(){if(n.length){var e=n.shift();u(3,"Executing "+JSON.stringify(e)+" from queue"),"write"==e.type?a.write(e.data,e.callback,e.callbackNewline):u(1,"Unknown queue item "+JSON.stringify(e))}}function f(t){if(s()){var l,f,d,h={on:function(e,t){this["on"+e]=t},emit:function(e,t){this["on"+e]&&this["on"+e](t)},isOpen:!1,isOpening:!0,txInProgress:!1},g=void 0,v=[],p=!1,m=c;return h.close=function(){h.isOpening=!1,h.isOpen?(h.isOpen=!1,h.emit("close")):t&&t(null),g&&(g.disconnect(),g=void 0,f=void 0,d=void 0,m=c)},h.write=function(e,t){e&&v.push({data:e,callback:t,maxLength:e.length}),h.isOpen&&!h.txInProgress&&function e(){var t;if(p)setTimeout(e,50);else if(v.length){var n=v[0];a.writeProgress(n.maxLength-n.data.length,n.maxLength),n.data.length<=m?(t=n.data,n.data=void 0):(t=n.data.substr(0,m),n.data=n.data.substr(m)),h.txInProgress=!0,u(2,"Sending "+JSON.stringify(t)),f.writeValue(function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0,o=e.length;i<o;i++)n[i]=e.charCodeAt(i);return t}(t)).then((function(){u(3,"Sent"),n.data||(v.shift(),n.callback&&n.callback()),h.txInProgress=!1,e()})).catch((function(e){u(1,"SEND ERROR: "+e),v=[],h.close()}))}else a.writeProgress()}()},navigator.bluetooth.requestDevice({filters:[{namePrefix:"Puck.js"},{namePrefix:"Pixl.js"},{namePrefix:"MDBT42Q"},{namePrefix:"RuuviTag"},{namePrefix:"iTracker"},{namePrefix:"Thingy"},{namePrefix:"Espruino"},{services:[i]}],optionalServices:[i]}).then((function(e){u(1,"Device Name:       "+e.name),u(1,"Device ID:         "+e.id),e.addEventListener("gattserverdisconnected",(function(){u(1,"Disconnected (gattserverdisconnected)"),h.close()})),h.device=e,h.reconnect(t)})).catch((function(e){u(1,"ERROR: "+e),h.close()})),h.reconnect=function(t){h.device.gatt.connect().then((function(e){return u(1,"Connected"),g=e,e.getPrimaryService(i)})).then((function(e){return u(2,"Got service"),(l=e).getCharacteristic(r)})).then((function(e){return d=e,u(2,"RX characteristic:"+JSON.stringify(d)),d.addEventListener("characteristicvaluechanged",(function(e){var t,n=(t=e.target.value.buffer,String.fromCharCode.apply(null,new Uint8Array(t)));if(a.increaseMTU&&n.length>m&&(u(2,"Received packet of length "+n.length+", increasing chunk size"),m=n.length),a.flowControl)for(var i=0;i<n.length;i++){var o=n.charCodeAt(i),r=!0;19==o?(u(2,"XOFF received => pause upload"),p=!0):17==o?(u(2,"XON received => resume upload"),p=!1):r=!1,r&&(n=n.substr(0,i-1)+n.substr(i+1),i--)}u(3,"Received "+JSON.stringify(n)),h.emit("data",n)})),d.startNotifications()})).then((function(){return l.getCharacteristic(o)})).then((function(e){f=e,u(2,"TX characteristic:"+JSON.stringify(f))})).then((function(){h.txInProgress=!1,h.isOpen=!0,h.isOpening=!1,e=!1,n=[],t(h),h.emit("open"),h.write()})).catch((function(e){u(1,"ERROR: "+e),h.close()}))},h}}function d(i,o,r){if(!s())return;let c;if("function"!=typeof o&&(r=o,c=new Promise(((e,t)=>o=(n,i)=>{i?t(i):e(n)}))),e)return u(3,"Busy - adding Puck.write to queue"),n.push({type:"write",data:i,callback:o,callbackNewline:r}),c;var a;function d(){r&&(t.cb=function(n){var i=t.received.indexOf("\n");if(i>=0){var r=t.received.substr(0,i);t.received=t.received.substr(i+1),t.cb=void 0,a&&clearTimeout(a),a=void 0,o&&o(r),e=!1,l()}});var n=300,i=r?100:3,c=i;a=setTimeout((function r(){a=void 0,n&&n--,c&&c--,t.hadData&&(c=i),c&&n?a=setTimeout(r,100):(t.cb=void 0,o&&o(t.received),e=!1,l(),t.received=""),t.hadData=!1}),100)}return t&&(t.isOpen||t.isOpening)?(t.txInProgress||(t.received=""),e=!0,t.write(i,d),c):(t=f((function(n){if(!n)return t=void 0,void(o&&o(null));t.received="",t.on("data",(function(e){t.received+=e,t.hadData=!0,t.cb&&t.cb(e)})),t.on("close",(function(e){t=void 0})),e=!0,t.write(i,d)})),c)}},"function"==typeof define&&n.amdO?define([],o):e.exports?e.exports=o():i.Puck=o();const r={Puck}}}]);